# 7. 流水系统

使用"智慧校园卡"吃饭、喝水，便经过了这两套系统。

::: warning 免责声明
本站只介绍对其机制的一部分猜想及使用经验。擅自进行破解或用于商业目的，违反校规甚至法律法规的，后果责任自负。
:::


## 饭卡流水系统

推测饭卡余额数据记录在相关服务器中，因为每次消费都涉及后台入账，学生余额在微信公众号中也可查询、充值。卡上至多存一份余额数据的副本。

食堂、小卖部（原）、医务室刷卡机通过网线与后端连接。寝室洗澡计费设备先与走廊上方中转设备通信，再与后端连接。

![寝室洗澡水后端](/img/BathwaterGateway.png)

## 水卡流水机制

饮水机均不连网，且退卡、换卡后水卡费用无法转移，可见水卡数据写在卡上。

若要修改，首先需读取卡上加密数据。据说"智慧校园卡"这一类NFC卡现在已经能够用特殊设备读取第一层密钥了，这一步过了后，可能还需观察16进制数据的跳动规律以进行逆向。
